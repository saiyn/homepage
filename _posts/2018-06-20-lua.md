---
layout: post
title:  "lua笔记"
date:   2018-06-20 15:15:54
categories: Language
excerpt: lua
---

* content
{:toc}

记录开发中实际涉及的lua语音知识

---

# 基本语法

<br />

## Tables

<br />

table是lua中唯一的一个原生数据结构，它是基于hash-lookup dicts实现的，所以非常的灵活，可以很方便的将table当成字典、map、list等使用。

<br />

### Using table as list / array

<br />

用lua中的table实现的list / array 要比python中的list和c语言中的array灵活很多。

	v = {'monday', 99, 'value2', 1.21}
	
	for i = 1, #v do  -- #v is the size of v for lists.
		print(v[i])
	end
	

### Using table as dictionary / map

<br />

使用lua中的table实现字典或者map时，要注意和上面实现的list在访问元素上的区别。

	t = {key1 = 'value', key2 = false, key3 = 2.2}
	
	-- 只要key是字符串，就可以通过dot notation访问value
	print(t.key1)
	t.newkey = {}  -- 添加newkey = {}
	t.key2 = nil   -- 从table中删除key2
	
lua中除了默认使用字符串作为字典的key，还可以使用任何非nil值作为key：

	u = {['@!#'] = 'qbert', [{}] = 666, [2.68] = 'saiyn'}
	print(u[2.68])  -- prints "saiyn"


--- 

<br />

# 与C语言交互

<br />

Lua是一种嵌入式语言。即Lua不是一个单独运行的程序，而是一个可以链接到其他程序的库。通过链接就可以将Lua的功能合并入这些程序。Lua和C语言之间一种最常见的交互方式是:

* 1. C程序中使用Lua提供的C API编写一些特定模式的模块，然后注册到Lua中。
* 2. 使用Lua编写功能代码，lua代码中可以调用之前注册进来的C函数。
* 3. C程序中使用Lua提供的C API编译加载lua代码文件，运行代码。

从上面的交互过程可以看出，Lua确实是依附着C语言运行的。那么这就引出一个问题，为啥不直接运行C代码，而绕一个弯的去执行Lua代码？

这是因为Lua作为High-level语言，具备很多C语言没有的优势，比如:

* Lua支持一些高级特性，如function closures、垃圾回收等等。
* Lua比C语言安全。
* Lua is a dynamic language: it requires no "off-line" compilation.

将C模块注册到Lua中有多种方式，包括:

* 1. 如果这个模块作为独立的库，那么可以编译成动态链接库`.so`,并将这个库放入C路径(LUA_CPATH)中。然后，便可以用require从Lua中加载这个模块。
* 2. 将这个模块登记到Lua标准库中的linit.c文件中，然后从新编译整个Lua，这样调用luaL_openlibs函数时就可以打开这个模块。
* 3. 这个C模块作为C程序的一部分，而这个C程序主体部分包含了加载lua文件执行的功能。这个方式也就是上面提到的最常见的C和lua交互方式的一部分。

<br />

## C API概述

<br />

### 栈操作API

<br />

`void lua_pushvalue(lua_State *L, int index);`

lua_pushvalue函数会将指定索引上的副本压人栈。













	
	
	

