---
layout: post
title:  "Docker 笔记"
date:   2019-11-21 15:15:54
categories: Linux
excerpt: Docker linux container
---

* content
{:toc}


# Basic

<br />

## 安装docker

<br />

[参考这个](https://docs.docker.com/engine/install/ubuntu/)


<br />

## 基本命令

<br />

* 进入container内的shell -> `sudo docker container exec -it 3695c98d9f78 /bin/bash`
* 清除系统中所有的container和images -> `sudo docker system prune -a`
* 清除系统中所有的docker volumes -> `sudo docker volume prune`
* 清除所有container的log -> `sudo sh -c "truncate -s 0 /var/lib/docker/containers/*/*-json.log"`

<br />


## DockerHub的使用

<br />

基于别人public的image进行开发后，可以commit然后push到自己的DokcerHub仓库下。

比如上传修改后的image到我的elk仓库：saiyn/elk

* 执行`docker container ps`查看elk的CONTAINER ID， 假设为c78ade920bae.
* 执行`docker commit -m "refine index pattern;add one more filebeat input" c78ade920bae saiyn/elk:v1.0.3`生成一个新的image，并且打上tag：v1.0.3
* 执行`docker push saiyn/elk:v1.0.3`将新image推送到dockerHub的elk仓库.


<br />



## docker-compose的应用

<br />

### 重新build并启动某一个service

<br />
在我们更新了ui容器的js代码后，如果只是执行`docker-compose restart ui`会发现网页并没有更新
这时可以依次执行如下命令:

* docker-compose stop ui
* docker-compose build --no-cache ui
* docker-compose up -d --no-deps ui

<br />

---

# docker in Pycharm

<br />

## pycharm in windows

<br />

> requirement: pycharm professional version + windows 10 enterprise

**key step to set docker-compose env for pycharm**

* install docker desktop
* exec `docker pull busybox` in docker desktop to install busybox image
* enable `Expose daemon on tcp://localhost:2375 without tls` in docker desktop setting page
* set Engine API URL to `tcp://localhost::2375` in pycharm FILE->Setting->Build,Execution,Deployment setting page
* Add python Interpreter in pycharm FILE->Setting->Project:xxx ->Docker Compose setting page

> 上面这一步是可以让我们直接在pycharm中调试docker container中的python工程，比如你的docker-compose是搭建一个web server项目，里面构建了7、8个container, 其他一个叫`api`
> 的contaienr可能就是你基于flask构建的web server,这时你在docker compose setting apge中的serice选项中选择api。




## pycharm in ubuntu

<br />

在window上设置Docker的`Expose daemon on tcp://localhost:2375 without TLS`很方便，当时ubuntu上有点免费，查询了各种解决方案，发现使用nmap的ncat工具可以轻松解决问题。

  $sudo ncat -lknvp 2375 -c "ncat -U /var/run/docker.sock"

<br />




